language: python
python: 3.8
cache: pip

install:
    pip install -r requirements-dev.pip

env:
- PYTHON="python"
- TEST_CMD="python -m pytest -v --cov=pegen --cov-report term"

script:
- $TEST_CMD

after_success:
- coveralls

notifications:
  on_success: change
  on_failure: always

matrix:
  include:
    - name: "mypy"
      python: 3.8
      script:
          - mypy pegen

    - name: "makefile_targets"
      python: 3.8
      env:
          - PYTHON="python"
      script:
          - make clean
          - make dump
          - make test
          - make simpy
          - make regen-metaparser

    - name: "simpy_cpython"
      python: 3.8
      env:
          - PYTHON="python"
          - CPYTHON="./cpython"
      script:
          - time git clone https://github.com/python/cpython.git
          - make clean
          - make
          - make simpy_cpython
